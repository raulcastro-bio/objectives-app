<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Objetivos</title>

  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#4caf50" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />

  <link rel="stylesheet" href="styles.css?v=7">
</head>

<body>
  <h1>App Objetivos</h1>

  <nav class="tabs">
    <button class="tab active" data-tab="calendar" onclick="switchTab('calendar')">ğŸ“… Calendario</button>
    <button class="tab" data-tab="breakdown" onclick="switchTab('breakdown')">ğŸ§© Desglose</button>
  </nav>

  <button id="menu-btn" aria-label="MenÃº" onclick="toggleSidebar()">â˜°</button>

  <div id="sidebar" class="sidebar">
    <!-- Vista principal -->
    <div id="sidebar-main" class="sidebar-view">
      <div class="sidebar-header">
        <h2>ğŸ¯ Objetivos</h2>
        <button class="close-btn" onclick="toggleSidebar()">âœ•</button>
      </div>

      <h3>Resumen</h3>
      <div id="goal-summary"></div>

      <h3>Agregar nuevo</h3>
      <div class="sidebar-add">
        <input id="new-goal-title" placeholder="Nuevo objetivoâ€¦" />
        <input id="new-goal-color" type="color" value="#4caf50" />
        <button onclick="addGoal()">AÃ±adir</button>
      </div>

      <div class="sidebar-bottom">
        <button class="settings-btn" onclick="openSettingsScreen()">âš™ Ajustes</button>
      </div>
    </div>

    <!-- Vista ajustes -->
    <div id="sidebar-settings" class="sidebar-view hidden">
      <div class="sidebar-header">
        <button class="close-btn" onclick="closeSettings()">â†</button>
        <h2>Ajustes</h2>
        <button class="close-btn" onclick="toggleSidebar()">âœ•</button>
      </div>

      <h3>Backup</h3>
      <button onclick="exportData()">Exportar datos</button>
      <button onclick="document.getElementById('import-file').click()">Importar datos</button>
      <input
        id="import-file"
        type="file"
        accept="application/json"
        style="display:none"
        onchange="importData(event)"
      />
    </div>
  </div>

  <div id="overlay" class="overlay hidden" onclick="toggleSidebar()"></div>

  <section id="tab-calendar" class="tab-content active">
    <div id="year-selector">
      <button onclick="prevYear()">â—€</button>
      <span id="year-label"></span>
      <button onclick="nextYear()">â–¶</button>
    </div>

    <div id="calendar-year"></div>
  </section>

  <section id="tab-breakdown" class="tab-content">
    <h2>ğŸ§© Desglose de objetivos</h2>
    <div id="breakdown-list"></div>
  </section>

  <!-- Pantalla completa de Ajustes -->
  <div id="settings-screen" class="settings-screen hidden">
    <div class="settings-topbar">
      <button class="close-btn" onclick="closeSettingsScreen()">â†</button>
      <div class="settings-title">Ajustes</div>
      <button class="close-btn" onclick="closeSettingsScreen()">âœ•</button>
    </div>

    <div class="settings-content">
      <h3>Backup</h3>
      <button onclick="exportData()">Exportar datos</button>
      <button onclick="document.getElementById('import-file').click()">Importar datos</button>
      <input
        id="import-file"
        type="file"
        accept="application/json"
        style="display:none"
        onchange="importData(event)"
      />

      <h3>Backup automÃ¡tico</h3>

      <div class="settings-card">
        <label class="settings-label">Email destino</label>
        <input id="auto-backup-email" type="email" placeholder="tu@email.com" />

        <label class="settings-label">Frecuencia</label>
        <select id="auto-backup-frequency">
          <option value="daily">Cada dÃ­a</option>
          <option value="weekly" selected>Cada semana</option>
          <option value="monthly">Cada mes</option>
        </select>

        <label class="settings-row">
          <input id="auto-backup-enabled" type="checkbox" />
          Activar backup automÃ¡tico (cuando abras la app)
        </label>

        <button onclick="runAutoBackupNow()">Enviar backup ahora</button>

        <p class="settings-hint">
          Nota: en iPhone, una PWA no puede enviar emails en segundo plano. Este backup se ejecuta cuando abres la app y te abre el envÃ­o para confirmarlo.
        </p>
      </div>

    </div>
  </div>


  <script src="app.js?v=7"></script>
</body>
</html>
